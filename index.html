<!doctype html>
<html>
  <head>
    <title>demo</title>
    <style>
      body {
        margin: 0;
        padding: 0;
        overflow: hidden;
        background-color: #F0F0F0;
      }


    </style>
    <script src="/socket.io/socket.io.js"></script>
    <script src="https://code.jquery.com/jquery-1.11.1.js"></script>
    <script src="https://cdn.rawgit.com/konvajs/konva/1.3.0/konva.js"></script>
  </head>
  <body>
    
    <div id="container"></div>
    <script type="text/javascript">

      $(() => {
        var socket;
        socket = io({transports: ['websocket']});

        var width = window.innerWidth;
        var height = window.innerHeight;
        var star;

        var tween = null;

        var stage = new Konva.Stage({
          container: 'container',
          width: width,
          height: height
        });

        var layer = new Konva.Layer();
        var dragLayer = new Konva.Layer();

        var scale = 1;

        star = new Konva.Star({
          x: stage.getWidth() / 2,
          y: stage.getHeight() / 2,
          numPoints: 5,
          innerRadius: 130,
          outerRadius: 250,
          fill: '#89b717',
          opacity: 0.8,
          draggable: true,
          scale: {
            x : scale,
            y : scale
          },
          rotation: 0,
          shadowColor: 'black',
          shadowBlur: 10,
          shadowOffset: {
            x : 5,
            y : 5
          },
          shadowOpacity: 0.6,
          // custom attribute
          startScale: scale
        });

        layer.add(star);

        star.on('dragmove', (evt) => {
          console.log('evt', evt.target.attrs.x, evt.target.attrs.y);
          socket.emit('evt', {x: evt.target.attrs.x, y: evt.target.attrs.y});
        })
        

        socket.on('evt', function(msg){
          console.log('evt received', msg);
          star.setAttrs({
            x: msg.x,
            y: msg.y
          })
          stage.draw();
        });

        
        
        stage.add(layer, dragLayer);

        stage.on('dragstart', function(evt) {
          var shape = evt.target;
          // moving to another layer will improve dragging performance
          shape.moveTo(dragLayer);
          stage.draw();
          
          if (tween) {
            tween.pause();
          }
          shape.setAttrs({
            shadowOffset: {
              x: 15,
              y: 15
            },
            scale: {
              x: shape.getAttr('startScale') * 1.2,
              y: shape.getAttr('startScale') * 1.2
            }
          });
        });

        stage.on('dragend', function(evt) {
          var shape = evt.target;
          shape.moveTo(layer);
          stage.draw();
          shape.to({
            duration: 0.5,
            easing: Konva.Easings.ElasticEaseOut,
            scaleX: shape.getAttr('startScale'),
            scaleY: shape.getAttr('startScale'),
            shadowOffsetX: 5,
            shadowOffsetY: 5
          });
        });
      });
      
      

    </script>
  </body>
</html>